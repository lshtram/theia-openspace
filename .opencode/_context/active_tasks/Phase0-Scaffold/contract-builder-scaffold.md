# Contract: Builder - Scaffold Monorepo

**Task ID:** Phase0.2-ScaffoldMonorepo  
**Assigned to:** Builder  
**Priority:** P0 (blocks all other Phase 0 tasks)  
**Created:** 2026-02-16  
**Oracle:** oracle_e3f7

---

## Objective

Create a complete, buildable Theia monorepo with Yarn workspaces. This is the foundation for all subsequent development.

## Background

- **Theia Version:** Pin to exactly `1.68.2` for all @theia/* packages (confirmed by Scout research)
- **Architecture:** Compile-time Theia extensions (not plugins)
- **Package Manager:** Yarn (required by Theia)
- **Reference:** WORKPLAN.md Phase 0, TECHSPEC-THEIA-OPENSPACE.md §2.2

## Deliverables

Create the following directory structure in `/Users/Shared/dev/theia-openspace/`:

```
theia-openspace/
├── package.json                    # Root workspace configuration
├── tsconfig.json                   # Root TypeScript config
├── yarn.lock                       # Generated by yarn install
├── .gitignore                      # Standard Node + Theia ignores
├── README.md                       # Basic setup instructions
├── browser-app/                    # Browser application target
│   ├── package.json
│   ├── src-gen/
│   └── lib/                        # Generated by build
├── electron-app/                   # Electron application target (Phase 5)
│   └── package.json                # Stub for now
├── extensions/                     # Our custom extensions
│   ├── openspace-core/
│   │   ├── package.json
│   │   └── src/
│   │       ├── common/
│   │       ├── browser/
│   │       └── node/
│   ├── openspace-chat/
│   │   ├── package.json
│   │   └── src/browser/
│   ├── openspace-presentation/
│   │   ├── package.json
│   │   └── src/browser/
│   ├── openspace-whiteboard/
│   │   ├── package.json
│   │   └── src/browser/
│   ├── openspace-layout/
│   │   ├── package.json
│   │   └── src/browser/
│   └── openspace-settings/
│       ├── package.json
│       └── src/
│           ├── common/
│           └── browser/
└── configs/
    └── tsconfig.base.json          # Shared TypeScript config
```

## Detailed Specifications

### 1. Root package.json

```json
{
  "name": "theia-openspace",
  "version": "0.1.0",
  "private": true,
  "license": "MIT",
  "engines": {
    "node": ">=18.0.0",
    "yarn": ">=1.7.0 <2"
  },
  "workspaces": [
    "browser-app",
    "electron-app",
    "extensions/*"
  ],
  "scripts": {
    "build": "yarn build:extensions && yarn build:browser",
    "build:extensions": "yarn --cwd extensions/openspace-core build && yarn --cwd extensions/openspace-chat build && yarn --cwd extensions/openspace-presentation build && yarn --cwd extensions/openspace-whiteboard build && yarn --cwd extensions/openspace-layout build && yarn --cwd extensions/openspace-settings build",
    "build:browser": "yarn --cwd browser-app build",
    "build:electron": "yarn --cwd electron-app build",
    "start:browser": "yarn --cwd browser-app start",
    "start:electron": "yarn --cwd electron-app start",
    "watch": "yarn --cwd browser-app watch",
    "clean": "yarn --cwd browser-app clean && yarn --cwd electron-app clean && rimraf extensions/*/lib extensions/*/tsconfig.tsbuildinfo",
    "lint": "eslint . --ext .ts,.tsx",
    "test": "jest"
  },
  "devDependencies": {
    "@types/node": "^18.0.0",
    "typescript": "~5.4.5",
    "rimraf": "^5.0.0",
    "eslint": "^8.0.0",
    "@typescript-eslint/eslint-plugin": "^7.0.0",
    "@typescript-eslint/parser": "^7.0.0",
    "jest": "^29.0.0",
    "@types/jest": "^29.0.0",
    "ts-jest": "^29.0.0"
  }
}
```

### 2. Root tsconfig.json

```json
{
  "extends": "./configs/tsconfig.base.json",
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@openspace/*": ["extensions/*/src"]
    }
  },
  "exclude": ["node_modules", "lib", "*.d.ts"]
}
```

### 3. configs/tsconfig.base.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "moduleResolution": "node",
    "lib": ["ES2020", "DOM"],
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "composite": true,
    "incremental": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noImplicitThis": true,
    "noUnusedLocals": true,
    "strictNullChecks": true,
    "strictPropertyInitialization": true,
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true
  }
}
```

### 4. browser-app/package.json

```json
{
  "name": "theia-openspace-browser",
  "version": "0.1.0",
  "license": "MIT",
  "theia": {
    "target": "browser",
    "frontend": {
      "config": {
        "applicationName": "Theia Openspace",
        "preferences": {
          "files.enableTrash": false
        }
      }
    }
  },
  "dependencies": {
    "@theia/core": "1.68.2",
    "@theia/editor": "1.68.2",
    "@theia/filesystem": "1.68.2",
    "@theia/markers": "1.68.2",
    "@theia/messages": "1.68.2",
    "@theia/monaco": "1.68.2",
    "@theia/navigator": "1.68.2",
    "@theia/outline-view": "1.68.2",
    "@theia/preferences": "1.68.2",
    "@theia/preview": "1.68.2",
    "@theia/search-in-workspace": "1.68.2",
    "@theia/terminal": "1.68.2",
    "@theia/workspace": "1.68.2",
    "@theia/ai-core": "1.68.2",
    "@theia/ai-chat": "1.68.2",
    "@theia/ai-chat-ui": "1.68.2",
    "@theia/ai-ide": "1.68.2",
    "openspace-core": "0.1.0",
    "openspace-chat": "0.1.0",
    "openspace-presentation": "0.1.0",
    "openspace-whiteboard": "0.1.0",
    "openspace-layout": "0.1.0",
    "openspace-settings": "0.1.0"
  },
  "devDependencies": {
    "@theia/cli": "1.68.2"
  },
  "scripts": {
    "build": "theia build --mode development",
    "start": "theia start --port 3000",
    "watch": "theia build --watch --mode development",
    "clean": "rimraf lib src-gen"
  }
}
```

### 5. Extension Package Template (openspace-core as example)

**extensions/openspace-core/package.json:**

```json
{
  "name": "openspace-core",
  "version": "0.1.0",
  "license": "MIT",
  "theiaExtensions": [
    {
      "frontend": "lib/browser/openspace-core-frontend-module",
      "backend": "lib/node/openspace-core-backend-module"
    }
  ],
  "dependencies": {
    "@theia/core": "1.68.2",
    "@theia/editor": "1.68.2",
    "@theia/filesystem": "1.68.2",
    "@theia/workspace": "1.68.2",
    "@theia/terminal": "1.68.2"
  },
  "devDependencies": {
    "rimraf": "^5.0.0",
    "typescript": "~5.4.5"
  },
  "scripts": {
    "build": "tsc",
    "clean": "rimraf lib tsconfig.tsbuildinfo",
    "watch": "tsc --watch"
  }
}
```

**extensions/openspace-core/tsconfig.json:**

```json
{
  "extends": "../../configs/tsconfig.base.json",
  "compilerOptions": {
    "outDir": "lib",
    "rootDir": "src",
    "composite": true
  },
  "include": ["src"],
  "exclude": ["lib", "node_modules"]
}
```

### 6. Empty DI Module Files

Create placeholder files that compile but do nothing:

**extensions/openspace-core/src/browser/openspace-core-frontend-module.ts:**

```typescript
import { ContainerModule } from '@theia/core/shared/inversify';

export default new ContainerModule((bind, unbind, isBound, rebind) => {
  // TODO: Phase 1+ implementations
  console.log('[OpenSpaceCore] Frontend module loaded');
});
```

**extensions/openspace-core/src/node/openspace-core-backend-module.ts:**

```typescript
import { ContainerModule } from '@theia/core/shared/inversify';

export default new ContainerModule((bind, unbind, isBound, rebind) => {
  // TODO: Phase 1+ implementations
  console.log('[OpenSpaceCore] Backend module loaded');
});
```

Create similar placeholder files for all 6 extensions.

### 7. .gitignore

```
# Dependencies
node_modules/

# Build outputs
lib/
src-gen/
*.tsbuildinfo

# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Theia
.theia/

# Testing
coverage/
.nyc_output/

# Environment
.env
.env.local
```

### 8. README.md

Basic README with:
- Project description
- Prerequisites (Node 18+, Yarn 1.x)
- Setup instructions
- Build and run commands

## Success Criteria

- [ ] `yarn install` completes without errors
- [ ] `yarn build:extensions` compiles all 6 extensions
- [ ] `yarn build:browser` generates browser-app/lib and src-gen
- [ ] `yarn start:browser` launches Theia at http://localhost:3000
- [ ] No TypeScript compilation errors
- [ ] All extension DI modules are loaded (check browser console for "[OpenSpace*] module loaded" messages)

## Implementation Notes

1. **Theia CLI:** Use `@theia/cli` version 1.68.2 for building
2. **TypeScript:** Use version ~5.4.5 (Theia's supported range)
3. **Yarn:** Ensure yarn.lock is generated and committed
4. **Extension stubs:** Empty DI modules should compile and load without errors
5. **Testing:** Run `yarn build` and verify no errors before declaring complete

## Time Bound

Complete within 1-2 sessions. Report any blockers immediately.

## Output

Write `result.md` in this task directory with:
- Build output summary
- Any issues encountered and resolutions
- Confirmation that success criteria are met
- Next steps for Phase 0.3

---

**Oracle Note:** This is the foundation. Take time to get it right. All subsequent work depends on this scaffold. Use TDD where applicable (even if just "does it compile and load" tests initially).
